<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <title>Bl√§ddraNinja - s√∂kmotor</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container">
    <h1>üìö Bl√§ddraNinja </h1>
    <img src="/images/ninja.jpg" alt="Ninja som h√•ller i b√∂cker" class="ninja" />
 
    <div class="search-box">
      <input
        type="text"
        id="searchInput"
        placeholder="S√∂k efter titel, f√∂rfattare, bibliotek..."
      />
      <button onclick="search()">üîç S√∂k</button> 
    </div>
 <!-- s√∂k button ska ha med enter -->
  
    <div id="results"></div>
  </div>
 

  <script>
    async function search() {
      const query = document.getElementById("searchInput").value;
      try {
        // H√§r √§r √§ndringen: fullst√§ndig URL till backend
        const res = await fetch(
          `http://localhost:3000/api/search?q=${encodeURIComponent(query)}`
        );
        if (!res.ok) throw new Error(`Serverfel: ${res.status}`);
        const books = await res.json();
 
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = "";
 
        if (books.length === 0) {
          resultsDiv.innerHTML = "<p>Inga resultat hittades.</p>";
          return;
        }
 
        books.forEach((book) => {
          const meta = book.description || {};
          const imageName = book.file_name.replace(/\.[^/.]+$/, ".jpg");
          const imagePath = `/images/${imageName}`;
 
          resultsDiv.innerHTML += `
            <div class="book">
              <img
                src="${imagePath}"
                alt="Bokomslag"
                onerror="this.onerror=null;this.src='/images/ingen-bild.jpg';"
              />
              <div class="info">
                <h2>${meta.titel || "Ok√§nd titel"}</h2>
                <p><strong>F√∂rfattare:</strong> ${meta.f√∂rfattare || "Ok√§nd"}</p>
                <p><strong>Format:</strong> ${meta.format || "Ok√§nt format"}</p>
                <p><strong>Bibliotek:</strong> ${meta.plats || "Ej angiven"}</p>
                <p><strong>GPS:</strong> ${
                  meta.gps
                    ? `Lat: ${meta.gps[0]}, Lng: ${meta.gps[1]}`
                    : "Ej angiven"
                }</p>
              </div>
            </div>
          `;
        });
      } catch (error) {
        console.error("Fel vid s√∂kning:", error);
        const resultsDiv = document.getElementById("results");
        resultsDiv.innerHTML = `<p>Ett fel uppstod vid s√∂kningen: ${error.message}</p>`;
      }
    }
  </script>
</body>
</html>
 